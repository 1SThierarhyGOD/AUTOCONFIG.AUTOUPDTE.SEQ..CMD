<Project Sdk="Microsoft.DotNet.Helix.Sdk" DefaultTargets="Test">

  <PropertyGroup>
    <Language>msbuild</Language>

    <_workItemTimeout>00:20:00</_workItemTimeout>
    <WorkItemArchiveWildCard>$(TestArchiveTestsDir)**/*.zip</WorkItemArchiveWildCard>

    <IncludeDotNetCli>true</IncludeDotNetCli>
    <DotNetCliPackageType>sdk</DotNetCliPackageType>

    <GlobalJsonContent>$([System.IO.File]::ReadAllText('$(RepoRoot)global.json'))</GlobalJsonContent>
    <DotNetCliVersion>$([System.Text.RegularExpressions.Regex]::Match($(GlobalJsonContent), '(%3F&lt;="dotnet": ").*(%3F=")'))</DotNetCliVersion>
  </PropertyGroup>

  <ItemGroup>
    <_DefaultWorkItems Include="$(WorkItemArchiveWildCard)" />

    <HelixWorkItem Include="@(_DefaultWorkItems -> '%(FileName)')">
      <PayloadArchive>$(TestArchiveTestsDir)%(Identity).zip</PayloadArchive>
      <Command>dotnet test %(FileName).dll --ResultsDirectory:. &quot;--Framework:.NETCoreApp,Version=v8.0&quot; --logger:console</Command>
      <Timeout>$(_workItemTimeout)</Timeout>
    </HelixWorkItem>
  </ItemGroup>
</Project>
